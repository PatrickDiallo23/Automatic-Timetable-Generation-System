<div class="benchmark-dialog">
  <h1 mat-dialog-title class="dialog-title">
    <mat-icon class="title-icon">analytics</mat-icon>
    Benchmark Performance Analysis
  </h1>

  <div mat-dialog-content class="dialog-content">
    <!-- Loading State -->
    <div *ngIf="currentView === 'loading'" class="loading-container">
      <div class="loading-content">
        <mat-spinner diameter="40" color="primary"></mat-spinner>
        <h4 class="loading-title">Processing...</h4>
        <p class="loading-description">{{ currentOperation }}</p>
        <div class="loading-tips">
          <p>
            <mat-icon>info</mat-icon>
            This may take some time depending on data complexity
          </p>
        </div>
      </div>
    </div>

    <!-- Completion State -->
    <div *ngIf="currentView === 'completed'" class="completion-container">
      <div class="completion-content">
        <div class="completion-icon-container">
          <mat-icon class="completion-icon">check_circle</mat-icon>
        </div>
        <h4 class="completion-title">{{ completionMessage }}</h4>

        <!-- Show link if URL is available -->
        <div *ngIf="reportUrl" class="report-link-container">
          <p class="report-description">{{ completionType === 'aggregate' ? 'Your aggregate analysis report is ready:' : ' Your detailed report is ready:' }}</p>
          <button mat-raised-button class="report-link-btn" (click)="openReport()">
            <mat-icon>open_in_new</mat-icon>
            <span>Open Benchmark Report</span>
          </button>
        </div>

        <div class="completion-actions">
          <button mat-stroked-button class="secondary-action-btn" (click)="runAnother()">
            <mat-icon>refresh</mat-icon>
            Run Another Analysis
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="currentView === 'selectBenchmarksForAggregation'" class="selection-container">
      <div class="selection-header">
        <button mat-icon-button class="back-button" (click)="goBackToMain()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <h4 class="selection-title">Select Benchmarks to Aggregate</h4>
      </div>

      <div class="selection-content">
        <div *ngIf="availableDirectories.length === 0" class="no-benchmarks">
          <mat-icon class="no-benchmarks-icon">folder_off</mat-icon>
          <p>No benchmark results found in the benchmark directory.</p>
          <p class="hint">Run some benchmarks first to see them here.</p>
        </div>

        <div *ngIf="availableDirectories.length > 0" class="benchmarks-list">
          <div class="selection-controls">
            <button mat-stroked-button class="select-all-btn" (click)="selectAllDirectories()">
              <mat-icon>{{ isAllSelected() ? 'deselect' : 'select_all' }}</mat-icon>
              {{ isAllSelected() ? 'Deselect All' : 'Select All' }}
            </button>
            <span class="selection-count">
                            {{ getSelectedCount() }} of {{ availableDirectories.length }} selected
                        </span>
          </div>

          <div class="directories-container">
            <div *ngFor="let directory of availableDirectories; trackBy: trackByDirectoryName" class="directory-item" [class.selected]="directory.selected" (click)="toggleDirectorySelection(directory)">
              <mat-checkbox [checked]="directory.selected" (click)="$event.stopPropagation()" (change)="toggleDirectorySelection(directory)">
              </mat-checkbox>
              <div class="directory-info">
                <span class="directory-name">{{ directory.name }}</span>
                <span class="directory-hint">Benchmark results directory</span>
              </div>
            </div>
          </div>

          <div class="selection-actions">
            <button mat-raised-button class="aggregate-selected-btn" [disabled]="!hasSelectedDirectories" (click)="runSelectiveAggregation()">
              <mat-icon>assessment</mat-icon>
              Aggregate Selected ({{ getSelectedCount() }})
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div *ngIf="currentView === 'main'" class="main-content">
      <p class="intro-text">
        Choose your data source and analysis type:
      </p>

      <div class="options-container">
        <!-- Data Source Options -->
        <div class="option-group">
          <h5 class="group-title">
            <mat-icon>source</mat-icon>
            Data Source
          </h5>
          <div class="option-buttons">
            <button mat-raised-button class="option-btn database-btn" (click)="runBenchmark(false)" [disabled]="isLoading">
              <mat-icon>storage</mat-icon>
              <span>Database</span>
            </button>

            <button mat-raised-button class="option-btn upload-btn" (click)="triggerFileSelect()" [disabled]="isLoading">
              <mat-icon>upload_file</mat-icon>
              <span>Upload JSON</span>
            </button>
          </div>
        </div>

        <!-- Analysis Type Options -->
        <div class="option-group">
          <h5 class="group-title">
            <mat-icon>analytics</mat-icon>
            Analysis Type
          </h5>
          <div class="option-buttons aggregate-buttons">
            <button mat-raised-button class="option-btn aggregate-btn" (click)="runAggregateBenchmark()" [disabled]="isLoading">
              <mat-icon>assessment</mat-icon>
              <span>Aggregate All Analysis</span>
            </button>

            <button mat-raised-button class="option-btn selective-aggregate-btn" (click)="showSelectiveBenchmarkOptions()" [disabled]="isLoading">
              <mat-icon>tune</mat-icon>
              <span>Select & Aggregate</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- *ngIf="!isLoading && !isCompleted" -->
  <div class="info-panel" *ngIf="currentView === 'main'">
    <mat-icon class="info-icon">lightbulb</mat-icon>
    <div class="info-content">
      <h5>Analysis Options</h5>
      <ul>
        <li><strong>Database/Upload:</strong> Run new benchmark with current or custom data</li>
        <li><strong>Aggregate All:</strong> Combine all existing benchmark results into comprehensive report</li>
        <li><strong>Select & Aggregate:</strong> Choose specific benchmarks to compare and analyze</li>
      </ul>
    </div>
  </div>

  <div mat-dialog-actions class="dialog-actions">
    <button mat-stroked-button (click)="close()" class="cancel-btn">
      {{ currentView === 'completed' ? 'Close' : 'Cancel' }}
    </button>
  </div>

  <!-- Hidden file input -->
  <input #fileInput type="file" accept=".json" style="display: none" (change)="onFileSelected($event)" />
</div>
